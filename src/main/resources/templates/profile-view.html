<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>ë‚´ í”„ë¡œí•„ ë³´ê¸°</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-8">
<div class="max-w-2xl mx-auto bg-white p-8 rounded-xl shadow space-y-6">
    <div>
        <h2 class="text-3xl font-bold text-gray-800">ğŸ‘¤ ë‚´ í”„ë¡œí•„</h2>
    </div>

    <div class="space-y-4">
        <div>
            <h3 class="text-sm text-gray-500">ë‹‰ë„¤ì„</h3>
            <p id="nickname" class="text-lg font-semibold text-gray-800"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">ì´ë©”ì¼</h3>
            <p id="email" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">ì†Œê°œ</h3>
            <p id="bio" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">ì—°ë½ì²˜</h3>
            <p id="phone" class="text-gray-700"></p>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">ê¸°ìˆ  íƒœê·¸</h3>
            <div id="techTags" class="flex flex-wrap gap-2"></div>
        </div>
        <div>
            <h3 class="text-sm text-gray-500">ì„±í–¥ ì„¤ëª…</h3>
            <div id="personalityText" class="inline-block bg-blue-100 text-blue-800 text-sm px-3 py-1 rounded-full font-medium"></div>
        </div>
    </div>

    <div class="text-right">
        <button onclick="location.href='/profile/edit'" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition">
            í”„ë¡œí•„ ìˆ˜ì •
        </button>
    </div>
</div>
<button id="logoutBtn" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">
    ë¡œê·¸ì•„ì›ƒ
</button>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        try {
            const res = await fetch('/api/profile/me/full');
            if (res.status === 401 || res.status === 403) {
                window.location.href = '/auth/signin';
                return;
            }
            if (!res.ok) throw new Error('ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');

            const data = await res.json();

            document.getElementById('nickname').textContent = data.profile.nickname;
            document.getElementById('email').textContent = data.profile.email;
            document.getElementById('bio').textContent = data.profile.bio;
            document.getElementById('phone').textContent = data.profile.phone;

            // ê¸°ìˆ  íƒœê·¸ ì¶œë ¥
            const techTagsEl = document.getElementById('techTags');
            (data.tags.techTags || []).forEach(tag => {
                const span = document.createElement('span');
                span.textContent = tag;
                span.className = "inline-block bg-gray-200 text-gray-800 text-sm px-3 py-1 rounded-full";
                techTagsEl.appendChild(span);
            });

            // ì„±í–¥ ì„¤ëª… ì¶œë ¥
            document.getElementById('personalityText').textContent = data.tags.personalityText || 'ì •ë³´ ì—†ìŒ';
        } catch (err) {
            console.error('âŒ í”„ë¡œí•„ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', err);
            window.location.href = '/auth/signin';
        }
    });

    document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
            const res = await fetch('/auth/logout', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            });

            if (res.ok) {
                alert('ë¡œê·¸ì•„ì›ƒ ë˜ì—ˆìŠµë‹ˆë‹¤.');
                window.location.href = '/auth/signin';
            } else {
                throw new Error('ì„œë²„ ì‘ë‹µ ì˜¤ë¥˜');
            }
        } catch (err) {
            console.error('âŒ ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', err);
            alert('ë¡œê·¸ì•„ì›ƒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
        }
    });

</script>
</body>
</html>
