<div th:fragment="content" class="max-w-4xl mx-auto p-4 sm:p-6 bg-white rounded-lg shadow-md">
    <!-- ì œëª© -->
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-800 mb-6 sm:mb-8 border-b pb-3 sm:pb-4"
        th:text="${portfolio.portfolioId != null} ? 'í¬íŠ¸í´ë¦¬ì˜¤ ìˆ˜ì •' : 'í¬íŠ¸í´ë¦¬ì˜¤ ë“±ë¡'">
    </h1>

    <form th:action="${portfolio.portfolioId != null} ?
                @{'/portfolios/' + ${portfolio.portfolioId} + '/edit'} :
                @{/portfolios/new}"
          method="post" enctype="multipart/form-data" id="portfolio-form">
        <!-- CSRF í† í° (ì‹¤ì œ êµ¬í˜„ ì‹œ í™œì„±í™”) -->
        <!-- <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"> -->

        <!-- ID í•„ë“œ (ìˆ˜ì • ì‹œì—ë§Œ í‘œì‹œ) -->
        <input type="hidden" name="portfolioId" th:value="${portfolio.portfolioId}" th:if="${portfolio.portfolioId != null}">

        <!-- íƒ€ì… ì„ íƒ ì„¹ì…˜ -->
        <div class="mb-6">
            <label class="block text-lg font-semibold text-gray-700 mb-3">í¬íŠ¸í´ë¦¬ì˜¤ íƒ€ì… <span class="text-red-500">*</span></label>
            <div class="grid grid-cols-2 sm:grid-cols-3 gap-3">
                <div th:each="type : ${allTypes}">
                    <input type="radio" th:id="${'type-' + type}"
                           th:value="${type}" name="portfolioType"
                           th:checked="${portfolio.portfolioType == type}"
                           class="peer hidden" required>
                    <label th:for="${'type-' + type}"
                           class="block p-3 border-2 rounded-lg cursor-pointer text-center transition-colors
                                  peer-checked:border-primary peer-checked:bg-primary/10 peer-checked:text-primary
                                  hover:bg-gray-50">
                        <span th:text="${type}"></span>
                    </label>
                </div>
            </div>
            <span th:errors="${portfolio.portfolioType}" class="block text-sm text-red-500 mt-1"></span>
        </div>

        <!-- ì œëª© ì„¹ì…˜ -->
        <div class="mb-6">
            <label for="title" class="block text-lg font-semibold text-gray-700 mb-2">ì œëª© <span class="text-red-500">*</span></label>
            <input type="text" id="title" name="title" th:value="${portfolio.title}"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                   placeholder="í¬íŠ¸í´ë¦¬ì˜¤ ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”" required>
            <span th:errors="${portfolio.title}" class="block text-sm text-red-500 mt-1"></span>
        </div>

        <!-- í…œí”Œë¦¿ ì„ íƒ -->
        <div class="mb-6">
            <label for="templateSelect" class="block text-sm font-medium text-gray-700 mb-2">í…œí”Œë¦¿ ì„ íƒ</label>
            <select id="templateSelect" name="template" onchange="applyDefaultTemplate()"
                    class="w-full border border-gray-300 rounded-lg px-3 py-2">
                <option value="">ì„ íƒ ì•ˆ í•¨</option>
                <option value="basic">ê¸°ë³¸ í¬íŠ¸í´ë¦¬ì˜¤ í…œí”Œë¦¿</option>
            </select>
        </div>

        <!-- ì„¤ëª… ì„¹ì…˜ -->
        <div class="mb-6">
            <label for="description" class="block text-lg font-semibold text-gray-700 mb-2">ì„¤ëª… <span class="text-red-500">*</span></label>
            <textarea id="description" name="description" rows="8"
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
                      placeholder="í¬íŠ¸í´ë¦¬ì˜¤ì— ëŒ€í•œ ìƒì„¸ ì„¤ëª…ì„ ì‘ì„±í•´ì£¼ì„¸ìš” (ìµœëŒ€ 2000ì)"
                      th:text="${portfolio.description}" required></textarea>
            <div class="flex justify-between mt-1">
                <span th:errors="${portfolio.description}" class="block text-sm text-red-500"></span>
                <span class="text-sm text-gray-500" id="char-count">0/2000</span>
            </div>
        </div>

        <!-- ê¸°ì¡´ íŒŒì¼ í‘œì‹œ (ìˆ˜ì • ì‹œ) -->
        <div th:if="${portfolio.files != null and !portfolio.files.empty}" class="mb-6">
            <label class="block text-lg font-semibold text-gray-700 mb-3">ê¸°ì¡´ íŒŒì¼</label>
            <div class="space-y-3">
                <div th:each="file : ${portfolio.files}"
                     class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <div class="flex items-center min-w-0">
                        <span th:text="${file.filename}" class="truncate"></span>
                        <a th:href="${file.fileUrl}" target="_blank" class="ml-2 text-blue-500 hover:text-blue-700">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 10-2 0v3.586L7.707 9.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 10.586V7z" clip-rule="evenodd"/>
                            </svg>
                        </a>
                    </div>
                    <button type="button" class="text-red-500 hover:text-red-700 p-1"
                            onclick="confirmFileDelete(this)" th:data-file-id="${file.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <input type="hidden" class="file-status" th:value="${file.id}" th:data-file-id="${file.id}">
                </div>
            </div>
        </div>

        <!-- íŒŒì¼ ì—…ë¡œë“œ ì„¹ì…˜ -->
        <div class="mb-6">
            <label class="block text-lg font-semibold text-gray-700 mb-3">íŒŒì¼ ì²¨ë¶€</label>

            <!-- ì‹¤ì œ íŒŒì¼ ì…ë ¥ (ìˆ¨ê²¨ë‘ ) -->
            <input id="file-upload" name="files" type="file" multiple class="hidden" accept=".pdf,.jpg,.jpeg,.png,,.doc,.docx,.xls,.xlsx, .csv, .txt">

            <!-- ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì˜ì—­ -->
            <div id="drop-zone" class="mt-1 flex justify-center px-6 pt-8 pb-8 border-2 border-dashed border-gray-300 rounded-xl hover:border-primary transition-colors bg-gray-50 cursor-pointer"
                 onclick="document.getElementById('file-upload').click()"
                 ondragover="handleDragOver(event)"
                 ondragleave="handleDragLeave(event)"
                 ondrop="handleDrop(event)">

                <div class="space-y-3 text-center">
                    <svg class="mx-auto h-12 w-12 text-gray-400" stroke="currentColor" fill="none" viewBox="0 0 48 48">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8m-12 4h.02"
                              stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="text-sm text-gray-600">
                        <span class="font-medium text-primary">íŒŒì¼ ì„ íƒ</span>
                        ë˜ëŠ” ë“œë˜ê·¸ ì•¤ ë“œë¡­
                    </p>
                    <p class="text-xs text-gray-500">PDF, JPG, PNG, ZIP íŒŒì¼ (ìµœëŒ€ 50MB)</p>

                    <!-- ì„ íƒëœ íŒŒì¼ ëª©ë¡ -->
                    <div id="file-list" class="text-sm text-gray-700 mt-2 space-y-2 max-h-40 overflow-y-auto">
                        <p class="text-gray-400">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</p>
                    </div>
                </div>
            </div>
            <!-- íŒŒì¼ í¬ê¸° ì œí•œ ì•Œë¦¼ ë©”ì‹œì§€ -->
            <div id="file-size-error" class="hidden mt-2 p-2 text-sm text-red-500 bg-red-50 rounded"></div>
        </div>

        <!-- ì„ íƒëœ íŒŒì¼ ê´€ë¦¬ìš© ì»¨í…Œì´ë„ˆ (í¼ ì œì¶œ ì‹œ ì—¬ê¸°ì— ìˆëŠ” íŒŒì¼ë“¤ì´ ì „ì†¡ë¨) -->
        <div id="selected-files-container"></div>

        <!-- ì‚­ì œí•  íŒŒì¼ ID ëª©ë¡ì„ ë‹´ì„ ìˆ¨ê²¨ì§„ í•„ë“œë“¤ -->
        <div id="delete-files-container"></div>

        <!-- URL ì¶”ê°€ ì„¹ì…˜ -->
        <div class="mb-6">
            <label class="block text-lg font-semibold text-gray-700 mb-3">ì°¸ê³  URL</label>
            <div class="flex gap-2 mb-2">
                <input type="url" id="url-input" placeholder="https://example.com"
                       class="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent">
                <button type="button" id="add-url"
                        class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                    ì¶”ê°€
                </button>
            </div>
            <div id="url-error" class="hidden text-sm text-red-500 mb-2"></div>

            <div id="url-container" class="space-y-2">
                <!-- ê¸°ì¡´ URL ëª©ë¡ -->
                <div th:each="url : ${portfolio.urls}"
                     class="flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200">
                    <a th:href="${url.url}" th:text="${url.url}" target="_blank"
                       class="text-blue-500 hover:underline truncate"></a>
                    <button type="button" class="text-red-500 hover:text-red-700 p-1"
                            onclick="removeUrl(this, '${url}')" th:data-url-id="${url.id}">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    <input type="hidden" name="existingUrls" th:value="${url}">
                </div>
            </div>

            <!-- ìƒˆë¡œìš´ URL ëª©ë¡ì„ ë‹´ì„ ìˆ¨ê²¨ì§„ í•„ë“œë“¤ -->
            <div id="new-urls-container"></div>
        </div>

        <!-- ë²„íŠ¼ ê·¸ë£¹ -->
        <div class="flex flex-col sm:flex-row justify-end gap-3 pt-6 border-t">
            <a th:href="@{/portfolios}"
               class="px-6 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition-colors text-center">
                ì·¨ì†Œ
            </a>
            <button type="submit" id="submit-button"
                    class="px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors flex items-center justify-center">
                <span>ì €ì¥í•˜ê¸°</span>
                <svg id="loading-spinner" class="hidden ml-2 animate-spin h-5 w-5 text-white"
                     xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                    <path class="opacity-75" fill="currentColor"
                          d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                </svg>
            </button>
        </div>
    </form>

    <script>
        // í…œí”Œë¦¿ ìŠ¤í¬ë¦½íŠ¸
        function applyDefaultTemplate() {
            const select = document.getElementById("templateSelect");
            const textarea = document.getElementById("description");

            if (select.value === "basic") {
                textarea.value =
                    `ğŸ•’ ê¸°ê°„:
ğŸ’» ì‚¬ìš© ê¸°ìˆ :
ğŸ‘¤ ë§¡ì€ ì—­í• :
ğŸ¤ íŒ€ êµ¬ì„±:
ğŸ“Œ í”„ë¡œì íŠ¸ ê°œìš”:   `;
            } else {
                textarea.value = "";
            }
        }



        // ì „ì—­ ë³€ìˆ˜
        const MAX_FILE_SIZE = 50 * 1024 * 1024; // 50MB
        let selectedFiles = [];
        let deleteFileIds = [];
        let existingUrls = new Set([...document.querySelectorAll('input[name="existingUrls"]')].map(input => input.value));
        let newUrls = [];

        // DOM ìš”ì†Œ
        const fileInput = document.getElementById('file-upload');
        const fileList = document.getElementById('file-list');
        const dropZone = document.getElementById('drop-zone');
        const fileSizeError = document.getElementById('file-size-error');
        const urlInput = document.getElementById('url-input');
        const urlError = document.getElementById('url-error');
        const urlContainer = document.getElementById('url-container');
        const description = document.getElementById('description');
        const charCount = document.getElementById('char-count');

        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            // ê¸€ì ìˆ˜ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
            updateCharCount();

            // ê¸°ì¡´ URLì´ ìˆëŠ” ê²½ìš° í‘œì‹œ
            if (existingUrls.size > 0) {
                document.querySelector('#url-container p.text-gray-400')?.remove();
            }
        });

        // ê¸€ì ìˆ˜ ì—…ë°ì´íŠ¸
        function updateCharCount() {
            const count = description.value.length;
            charCount.textContent = `${count}/2000`;
            if (count > 2000) {
                charCount.classList.add('text-red-500');
            } else {
                charCount.classList.remove('text-red-500');
            }
        }

        // ë“œë˜ê·¸ ì˜¤ë²„ í•¸ë“¤ëŸ¬
        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.add('border-primary', 'bg-blue-50');
        }

        // ë“œë˜ê·¸ ë¦¬ë¸Œ í•¸ë“¤ëŸ¬
        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            dropZone.classList.remove('border-primary', 'bg-blue-50');
        }

        // ë“œë¡­ í•¸ë“¤ëŸ¬
        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            handleDragLeave(e);

            if (e.dataTransfer.files.length > 0) {
                processFiles(Array.from(e.dataTransfer.files));
            }
        }

        // íŒŒì¼ ì²˜ë¦¬
        function processFiles(files) {
            const oversizedFiles = files.filter(file => file.size > MAX_FILE_SIZE);

            if (oversizedFiles.length > 0) {
                showFileError(`${oversizedFiles.length}ê°œ íŒŒì¼ì´ 50MB ì œí•œì„ ì´ˆê³¼í–ˆìŠµë‹ˆë‹¤.`);
                files = files.filter(file => file.size <= MAX_FILE_SIZE);
            }

            selectedFiles = [...selectedFiles, ...files];
            updateFileDisplay();
        }

        // íŒŒì¼ ì˜¤ë¥˜ í‘œì‹œ
        function showFileError(message) {
            fileSizeError.textContent = message;
            fileSizeError.classList.remove('hidden');
            setTimeout(() => fileSizeError.classList.add('hidden'), 5000);
        }

        // íŒŒì¼ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateFileDisplay() {
            if (selectedFiles.length === 0) {
                fileList.innerHTML = '<p class="text-gray-400">ì„ íƒëœ íŒŒì¼ ì—†ìŒ</p>';
                return;
            }

            let html = `<p class="font-medium mb-1">ì„ íƒëœ íŒŒì¼ (${selectedFiles.length}ê°œ):</p><ul class="space-y-1">`;
            selectedFiles.forEach((file, index) => {
                html += `
                <li class="flex justify-between items-center bg-gray-50 p-2 rounded">
                    <div class="flex items-center min-w-0">
                        <span class="truncate">${file.name}</span>
                        <span class="text-xs text-gray-500 ml-2">(${formatFileSize(file.size)})</span>
                    </div>
                    <button type="button" onclick="removeFile(${index})" class="text-red-500 hover:text-red-700 p-1">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 20 20" fill="currentColor">
                            <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                </li>`;
            });
            html += '</ul>';
            fileList.innerHTML = html;
        }

        // íŒŒì¼ ì‚­ì œ
        function removeFile(index) {
            selectedFiles.splice(index, 1);
            updateFileDisplay();
        }

        // íŒŒì¼ í¬ê¸° í¬ë§·íŒ…
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        // íŒŒì¼ ì‚­ì œ í™•ì¸
        function confirmFileDelete(button) {
            if (confirm('ì´ íŒŒì¼ì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const fileId = button.getAttribute('data-file-id');
                deleteFileIds.push(fileId);
                button.closest('div').style.display = 'none';

                // ì‚­ì œí•  íŒŒì¼ IDë¥¼ í¼ì— ì¶”ê°€
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'deleteFileIds';
                input.value = fileId;
                document.getElementById('delete-files-container').appendChild(input);
            }
        }

        // URL ì¶”ê°€
        document.getElementById('add-url').addEventListener('click', function() {
            let url = urlInput.value.trim();

            // URL ìœ íš¨ì„± ê²€ì‚¬
            if (!url) {
                showUrlError('URLì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            // http:// ë˜ëŠ” https://ê°€ ì—†ëŠ” ê²½ìš° ì¶”ê°€
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                url = 'https://' + url;
            }

            // URL í˜•ì‹ ê²€ì¦
            try {
                new URL(url);
            } catch (e) {
                showUrlError('ìœ íš¨í•œ URL í˜•ì‹ì´ ì•„ë‹™ë‹ˆë‹¤.');
                return;
            }

            // ì¤‘ë³µ URL ê²€ì‚¬
            if (existingUrls.has(url) || newUrls.includes(url)) {
                showUrlError('ì´ë¯¸ ì¶”ê°€ëœ URLì…ë‹ˆë‹¤.');
                return;
            }

            // ìƒˆ URL ì¶”ê°€
            newUrls.push(url);
            addUrlToDisplay(url);
            urlInput.value = '';
            urlError.classList.add('hidden');

            // ìƒˆ URLì„ í¼ì— ì¶”ê°€
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'newUrls';
            input.value = url;
            document.getElementById('new-urls-container').appendChild(input);
        });

        // URL ì˜¤ë¥˜ í‘œì‹œ
        function showUrlError(message) {
            urlError.textContent = message;
            urlError.classList.remove('hidden');
            setTimeout(() => urlError.classList.add('hidden'), 3000);
        }

        // URL í‘œì‹œì— ì¶”ê°€
        function addUrlToDisplay(url) {
            const urlItem = document.createElement('div');
            urlItem.className = 'flex items-center justify-between bg-gray-50 p-3 rounded-lg border border-gray-200';
            urlItem.innerHTML = `
                <a href="${url}" target="_blank" class="text-blue-500 hover:underline truncate">${url}</a>
                <button type="button" class="text-red-500 hover:text-red-700 p-1" onclick="removeUrl(this, '${url}')">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd"/>
                    </svg>
                </button>
            `;
            urlContainer.appendChild(urlItem);
        }

        // URL ì‚­ì œ í•¨ìˆ˜
        function removeUrl(button, url) {
            const urlId = button.getAttribute('data-url-id');

            if (confirm('ì´ URLì„ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ê¸°ì¡´ URLì¸ ê²½ìš° (IDê°€ ìˆëŠ” ê²½ìš°)
                if (urlId) {
                    // ì‚­ì œí•  URL IDë¥¼ í¼ì— ì¶”ê°€
                    const deleteInput = document.createElement('input');
                    deleteInput.type = 'hidden';
                    deleteInput.name = 'deleteUrlIds';
                    deleteInput.value = urlId;
                    document.getElementById('delete-files-container').appendChild(deleteInput);
                }
                // ìƒˆ URLì¸ ê²½ìš°
                else {
                    // í¼ì—ì„œ ìƒˆ URL ì œê±°
                    const inputs = document.querySelectorAll('#new-urls-container input');
                    inputs.forEach(input => {
                        if (input.value === url) {
                            input.remove();
                        }
                    });
                    // ìƒˆ URL ëª©ë¡ì—ì„œ ì œê±°
                    newUrls = newUrls.filter(u => u !== url);
                }

                // í™”ë©´ì—ì„œ ì œê±°
                button.closest('div').remove();
            }
        }
        // í¼ ì œì¶œ ì²˜ë¦¬
        document.getElementById('portfolio-form').addEventListener('submit', function(e) {
            const submitButton = document.getElementById('submit-button');
            const loadingSpinner = document.getElementById('loading-spinner');

            // í•„ìˆ˜ í•„ë“œ ê²€ì¦
            const requiredFields = ['portfolioType', 'title', 'description'];
            for (const field of requiredFields) {
                if (!this.elements[field].value) {
                    e.preventDefault();
                    alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // ì„¤ëª… ê¸€ì ìˆ˜ ê²€ì¦
            if (description.value.length > 2000) {
                e.preventDefault();
                alert('ì„¤ëª…ì€ 2000ì ì´í•˜ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                description.focus();
                return;
            }

            // íŒŒì¼ í¬ê¸° ê²€ì¦
            const oversizedFiles = selectedFiles.filter(file => file.size > MAX_FILE_SIZE);
            if (oversizedFiles.length > 0) {
                e.preventDefault();
                showFileError('50MB ì´ìƒì˜ íŒŒì¼ì€ ì—…ë¡œë“œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            // ë¡œë”© ìƒíƒœ í‘œì‹œ
            submitButton.disabled = true;
            submitButton.querySelector('span').textContent = 'ì²˜ë¦¬ ì¤‘...';
            loadingSpinner.classList.remove('hidden');

            // ì„ íƒëœ íŒŒì¼ì´ ìˆëŠ” ê²½ìš°ì—ë§Œ íŒŒì¼ ì…ë ¥ í•„ë“œ ì¶”ê°€
            if (selectedFiles.length > 0) {
                const dataTransfer = new DataTransfer();
                selectedFiles.forEach(file => dataTransfer.items.add(file));

                const filesInput = document.createElement('input');
                filesInput.type = 'file';
                filesInput.name = 'files';
                filesInput.files = dataTransfer.files;
                filesInput.style.display = 'none';
                this.appendChild(filesInput);
            }
        });

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0) {
                processFiles(Array.from(this.files));
                this.value = ''; // ë™ì¼í•œ íŒŒì¼ ë‹¤ì‹œ ì„ íƒ ê°€ëŠ¥í•˜ë„ë¡ ì´ˆê¸°í™”
            }
        });

        description.addEventListener('input', updateCharCount);

        urlInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('add-url').click();
            }
        });
    </script>
</div>